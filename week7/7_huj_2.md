# DB 서버 이중화
## 서버 이중화 (액티브-스탠바이)
액티브: 실행되고 있는 것
스탠바이: 대기 상태
구현: 하드웨어나 클러스터 소프트웨어
클러스터 소프트웨어는 등록된 서비스가 정상 동작하고 있는지 정기적으로 확인
이상이 발생하면 액티브 서비스를 정지하고 대기하고 있던 스탠바이 측 서비스를 시작해서 유지함

### HA (High Availability, 고가용성) 구성
클러스터의 노드나 서비스 관계:  마스터-워커 개념을 기반
서버가 정상 동작하는지 확인하기 위한 구조로 하트비트나 투표 장치 같은 기능이 존재

### 클러스터 소프트웨어의 패일오버
장애-> 노드 상태 기록->액티브 종료나 os재시작->액티브 종료 확인 후 스탠바이실행
- 하트비트: 상태 확인
- 스플릿 브레인: 하트비트 확인 안되는 상태
- 투표 장치: 스플릿 브레인인 경우 실행 할 노드를 다수결로 결정

### 클러스터 구성용 서비스
액티브-스탠바이 구성은 서비스를 병렬로 실행할 수 없고 데이터 일관성을 중시하는 서비스/시스템에 적합
(예로 데이터베이스, 파일 서버, 잡 관리 시스템)
데이터 갱신이 거의 없어서 데이터 일관성이 중시되지 않고, 서비스 병렬 실행이 가능한 웹 서버나 AP 서버에서는 클러스터 소프트웨어를 사용하지 않음
원격복제 , 백업 필요

## 서버 이중화 (액티브-액티브)
db갱신,참조->병목현상의 가능성이 높음
이를 위해 확장가능한 기술 생김

### Shared Everything
디스크, 데이터를 모든 노드가 공유
장애가 발생하도 다른 노드로 쉽게 처리를 계속할 수 있다.
다른노드의 일관성 확인 필요->노드수를 늘려도 확장이 쉽지 않다.
액세스: 배타적제어와 데이터 경합 발생 속도 저하

- 캐시 전송
- 캐시 퓨전: 네트워크를 캐시에 연결한것
- 블록경함: 같은 블록이 네트워크를 통하는 경우 응답속도 저하되는 현상-> 리소스 넉넉한데 속도느리면 의심해봐야한다
- 배타적 제어: 캐시 퓨전을 보장하기 위한 구조
    - 최신블록이 어디 저장되었나

### Shared Nothing
각 노드별로 디스크를 가지고 있어서 데이터가 분산
노드를 배치하기 쉽다
대량 데이터 검색, 작은 트랜잭선의 대량 발생에서 유리 
- 데이터 보호
- 데이터 분산되기 때문에 손실될수 도 있다
- AP서버의 세션복제와 같은 방법으로 노드복사를 해둠

# 네트워크 장비 이중화
## L2 이중화
### 본딩: 두 개의 스위치를 연결하고 해서 패킷을 흐르게함+ 각서비에서 그 두개의 스위치에 각각 포트를 하나씩 연결함
- 두 개의 스위치를 연결하고 해서 패킷을 흐르게함->캐스케이드
- 스위치를 크로스 케이블로 연결해서 패킷을 흐르게 하는 기술

### 트렁크 포트:하나의 스위치가 여러 네트워크에서 사용되게 하는 것-> 스위치가 여러 VLAN을 설정함
원래는 스위치가 다른 스위치를 연결하는 VLAN이 하나씩 있는데 프렁크 포트는 하나의 포트에서 여러 VLAn을 연결해 서로다른 네트워크를 하나의 포트로 전달한다. 

### 트렁크 포트 시 중요한 점
하나의 포트로 연결되기 때문에 장애-> 스위치 전체 장애가 될수 도 있고 이 트렁크 포트가 병목지점이 될수 도 있다. 
->링크 집합 사용
링크 집합: 여러 포트를 합쳐 하나의 이더넷 포트로 사용하는 기술
평상시: 양쪽 포트 사용-> 장애시:하나로 사용->양쪽 포트 사용해 대역이 2배로 증가(병목현상 예방)

## L3 이중화
기본적으로 액티브- 스탠바이 구조
L3스위치: 스위치 + 라우터 기능
L2스위치: 포트증설이나 서버 접속시 사용 / L3 스위치: 다른 세그먼트의 라우터나 스위치와 연결시 사용

# 사이트 이중화
화재시 문제!->원격지 데이터 센터로 연계하자->글로벌 서버 부하 분산

### 글로벌 서버 부하 분산:( 재해복구 와 같은 말)
장애 발생시 장애가 발생하지않은 가장 가까운 ip 주소 와 연결하는 기술
DNS가 장애나지 않은 가장 가까운 IP주소를 동적으로 반한환다. 
-> 즉, 가장 중요하게 여겨지는 기술은 동기/비동기가 된다. 
원격지와 동기화 할때는 오버헤드를 고려해야하고 비동기일 경우 응답은 빠르지만 데이터 손실에 대해 고려해야함

# 감시
시스템 컴포넌트가 정상 동작하는지 확인하는 기능.

## 생존 감시
ping 명령을 정기적으로 실행해서 서버 인터페이스에 대한 통신을 확인하는 감시
ping 감시는 가능한 모든 장비에 설정할 것을 권장
 
## 로그 감시
OS나 미들웨어가 출력하는 로그 파일에는 시스템 유지를 위한 중요 정보가 포함됨
미들웨어 오류나 영역 고갈 등 생존 감시로는 알 수 없는 정보가 로그 파일로 출력된다.
장애 원인 분석에도 사용
 
## 성능 감시
디스크 사용률이나 메모리 사용 현황, 디스크 고갈 등의 리소스 상태 파악과 네트워크 액세스 지연, 디스크 액세스 시간 등의 응답 시간을 파악하는 것.

# 백업
데이터를 복제해서 별도 장소에 보관하는 것.
복원이나 복구를 이용해서 데이터를 원래 장소로 되돌리는 과정이 필요

## 복구 지표
RTO (Recovery Time Objective): 복구 목표 시간
복구에 어느 정도 시간이 걸리나?

RPO (Recovery Point Objective): 복구 기준 시점
어느 시점을 복구할 것인가?

## 시스템 백업
OS나 미들웨어 등 일반 서버의 로컬 디스크 영역을 백업하는 것.

## 데이터 백업
데이터베이스 백업은 데이터 자체와 데이터 갱신 내용이 기록돼 있는 저널을 모두 취득하도록 하고 있다.
데이터베이스가 망가진 경우라면 일관성 있는 데이터와 저널 로그 양쪽을 복원한다.
일관성 있는 데이터에 대해 저널 로그를 바탕으로 다시 트랜잭션을 실행해서 복구한다.
또한, 백업되지 않은 저널 로그가 장애 발생 직전까지 존재한다면 최신 데이터로 복구할 수 있다.
